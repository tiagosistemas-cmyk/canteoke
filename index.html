<!DOCTYPE html>
<html lang="pt-br">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>CANTEOKE</title>

<style>
body{
    background:#0a0a0f;
    font-family:Arial;
    color:white;
    margin:0;
    padding:15px;
}

.logo{
    text-align:center;
    margin-bottom:15px;
}

.logo img{
    width:180px;
    border-radius:12px;
    box-shadow:0 0 25px #00f7ff;
}

input{
    width:100%;
    padding:15px;
    font-size:18px;
    border-radius:10px;
    border:none;
    outline:none;
    background:#111;
    color:white;
    box-shadow:0 0 10px #00f7ff;
}

.contadores{
    margin-top:10px;
    margin-bottom:10px;
    font-size:14px;
    color:#00f7ff;
}

.resultado{
    background:#111;
    margin-top:10px;
    padding:12px;
    border-radius:10px;
    box-shadow:0 0 8px #00f7ff33;
}

.linha-topo{
    display:flex;
    justify-content:space-between;
    align-items:center;
    gap:12px;
}

.info-musica{
    flex:1;
    min-width:0;
}

.codigo{
    font-weight:bold;
    color:#00f7ff;
    white-space:nowrap;
    overflow:hidden;
    text-overflow:ellipsis;
}

.artista{
    font-size:14px;
    color:#aaa;
    white-space:nowrap;
    overflow:hidden;
    text-overflow:ellipsis;
}

.acoes{
    display:flex;
    gap:15px;
    align-items:center;
    flex-shrink:0;
}

/* STAR ANIMATION */
.star{
    font-size:26px;
    cursor:pointer;
    transition:0.2s;
    user-select:none;
}

.star.off{ color:white; }

.star.on{
    color:#ffcc00;
    text-shadow:0 0 5px #ffcc00, 0 0 15px #ffcc00;
    animation: starPulse 1.5s infinite alternate;
}

@keyframes starPulse{
    from{ transform:scale(1); text-shadow:0 0 5px #ffcc00; }
    to{ transform:scale(1.2); text-shadow:0 0 20px #ffcc00; }
}

/* WHATSAPP NEON PULSE */
.icon{
    width:26px;
    cursor:pointer;
    animation: neonPulse 1.5s infinite alternate;
}

@keyframes neonPulse{
    from{
        filter:drop-shadow(0 0 3px #25D366) drop-shadow(0 0 5px #25D366);
        transform:scale(1);
    }
    to{
        filter:drop-shadow(0 0 10px #25D366) drop-shadow(0 0 20px #25D366);
        transform:scale(1.15);
    }
}

/* Favoritos */
.favoritos-area{
    margin-top:25px;
}

.fav-header{
    display:flex;
    align-items:center;
    justify-content:space-between;
    gap:10px;
    margin-top:10px;
}

.fav-title{
    font-size:18px;
    font-weight:bold;
    color:#ffcc00;
}

.fav-tools{
    display:flex;
    gap:10px;
    align-items:center;
}

select, .btn{
    background:#111;
    color:white;
    border:1px solid #00f7ff55;
    border-radius:10px;
    padding:10px 12px;
    font-size:14px;
    outline:none;
    box-shadow:0 0 8px #00f7ff22;
}

.btn{
    cursor:pointer;
    white-space:nowrap;
}

.btn:hover{
    box-shadow:0 0 12px #00f7ff55;
}

.btn-danger{
    border-color:#ff444455;
    box-shadow:0 0 8px #ff444422;
}

.btn-danger:hover{
    box-shadow:0 0 12px #ff444455;
}

.small-hint{
    color:#9aa;
    font-size:12px;
    margin-top:6px;
}

/* Mobile */
@media(max-width:700px){
    .acoes{ gap:12px; }
    .icon{ width:24px; }
    .star{ font-size:24px; }
    select, .btn{ padding:10px; }
}
</style>
</head>
<body>

<div class="logo">
    <img src="canteoke.png" alt="CANTEOKE">
</div>

<input type="text" id="busca" placeholder="Digite c√≥digo, m√∫sica ou cantor">

<div class="contadores">
    <div id="contadorBase"></div>
    <div id="contadorResultado"></div>
    <div id="contadorFavoritos"></div>
</div>

<div id="resultados"></div>

<div class="favoritos-area">
    <div class="fav-header">
        <div class="fav-title" id="favTitulo">‚≠ê Favoritos</div>

        <div class="fav-tools">
            <select id="ordemFav" title="Ordenar favoritos">
                <option value="recentes">Recentes</option>
                <option value="codigo">C√≥digo</option>
                <option value="artista">Artista</option>
                <option value="musica">M√∫sica</option>
            </select>

            <button class="btn btn-danger" id="limparFav" title="Remover todos os favoritos">
                Limpar todos
            </button>
        </div>
    </div>

    <div class="small-hint">Dica: clique na ‚≠ê para remover do favorito.</div>

    <div id="favoritos"></div>
</div>

<script>
let musicas = [];
let favoritos = JSON.parse(localStorage.getItem("favoritos")) || [];
let favoritosMeta = JSON.parse(localStorage.getItem("favoritos_meta")) || {}; // {codigo: ts}

fetch("musicas.json")
.then(r => r.json())
.then(data => {
    musicas = data;
    document.getElementById("contadorBase").innerText = musicas.length.toLocaleString() + " m√∫sicas na base";
    atualizarContadorFavoritos();
    mostrarFavoritos();
});

function salvarFavoritos(){
    localStorage.setItem("favoritos", JSON.stringify(favoritos));
    localStorage.setItem("favoritos_meta", JSON.stringify(favoritosMeta));
}

function atualizarContadorFavoritos(){
    const n = favoritos.length;
    document.getElementById("contadorFavoritos").innerText = "‚≠ê " + n.toLocaleString() + " favoritos salvos";
    document.getElementById("favTitulo").innerText = "‚≠ê Favoritos (" + n.toLocaleString() + ")";
}

function ehFavorito(codigo){
    return favoritos.some(f => f.codigo === codigo);
}

function toggleFavorito(m){
    const idx = favoritos.findIndex(f => f.codigo === m.codigo);
    if(idx >= 0){
        favoritos.splice(idx, 1);
        delete favoritosMeta[m.codigo];
    }else{
        favoritos.push(m);
        favoritosMeta[m.codigo] = Date.now();
    }

    salvarFavoritos();
    atualizarContadorFavoritos();
    mostrarFavoritos();

    // Atualiza tamb√©m a lista de resultados (estrela)
    document.getElementById("busca").dispatchEvent(new Event("input"));
}

function normalizar(txt){
    return String(txt || "").toLowerCase().trim();
}

function ordenarFavoritos(lista){
    const modo = document.getElementById("ordemFav").value;

    const arr = [...lista];

    if(modo === "recentes"){
        arr.sort((a,b) => (favoritosMeta[b.codigo] || 0) - (favoritosMeta[a.codigo] || 0));
        return arr;
    }

    arr.sort((a,b) => {
        const va = normalizar(a[modo]);
        const vb = normalizar(b[modo]);
        if(va < vb) return -1;
        if(va > vb) return 1;
        // desempate por c√≥digo
        return String(a.codigo).localeCompare(String(b.codigo));
    });

    return arr;
}

function mostrarFavoritos(){
    const div = document.getElementById("favoritos");
    div.innerHTML = "";

    if(favoritos.length === 0){
        div.innerHTML = `<div class="resultado"><div class="codigo">Nenhum favorito ainda.</div><div class="artista">Pesquise uma m√∫sica e clique na ‚≠ê para salvar.</div></div>`;
        return;
    }

    const lista = ordenarFavoritos(favoritos);

    lista.forEach(m => {
        const texto = m.codigo + " - " + m.artista + " - " + m.musica;
        const link = "https://api.whatsapp.com/send?text=" + encodeURIComponent(texto);
        const starClass = ehFavorito(m.codigo) ? "star on" : "star off";

        div.innerHTML += `
        <div class="resultado">
            <div class="linha-topo">
                <div class="info-musica">
                    <div class="codigo">${m.codigo} - ${m.musica}</div>
                    <div class="artista">${m.artista}</div>
                </div>

                <div class="acoes">
                    <span class="${starClass}"
                        onclick="toggleFavorito({codigo:'${m.codigo}',artista:'${escapeJS(m.artista)}',musica:'${escapeJS(m.musica)}'})">‚òÖ</span>

                    <a href="${link}" target="_blank" aria-label="Enviar no WhatsApp">
                        <img src="https://cdn-icons-png.flaticon.com/512/733/733585.png" class="icon">
                    </a>
                </div>
            </div>
        </div>`;
    });
}

function escapeJS(s){
    // basic escaping for template literals inside HTML
    return String(s || "")
      .replaceAll("\\", "\\\\")
      .replaceAll("'", "\\'")
      .replaceAll("\n", " ")
      .replaceAll("\r", " ");
}

// Busca (n√£o mostra tudo de uma vez)
document.getElementById("busca").addEventListener("input", function(){
    const termo = this.value.toLowerCase();
    const div = document.getElementById("resultados");

    if(termo.length < 1){
        div.innerHTML = "";
        document.getElementById("contadorResultado").innerText = "";
        return;
    }

    const encontrados = musicas.filter(m =>
        String(m.codigo || "").toLowerCase().includes(termo) ||
        String(m.musica || "").toLowerCase().includes(termo) ||
        String(m.artista || "").toLowerCase().includes(termo)
    ).slice(0, 50);

    document.getElementById("contadorResultado").innerText =
        "üîé " + encontrados.length.toLocaleString() + " encontradas";

    div.innerHTML = "";

    encontrados.forEach(m => {
        const texto = m.codigo + " - " + m.artista + " - " + m.musica;
        const link = "https://api.whatsapp.com/send?text=" + encodeURIComponent(texto);
        const starClass = ehFavorito(m.codigo) ? "star on" : "star off";

        div.innerHTML += `
        <div class="resultado">
            <div class="linha-topo">
                <div class="info-musica">
                    <div class="codigo">${m.codigo} - ${m.musica}</div>
                    <div class="artista">${m.artista}</div>
                </div>

                <div class="acoes">
                    <span class="${starClass}"
                        onclick="toggleFavorito({codigo:'${m.codigo}',artista:'${escapeJS(m.artista)}',musica:'${escapeJS(m.musica)}'})">‚òÖ</span>

                    <a href="${link}" target="_blank" aria-label="Enviar no WhatsApp">
                        <img src="https://cdn-icons-png.flaticon.com/512/733/733585.png" class="icon">
                    </a>
                </div>
            </div>
        </div>`;
    });
});

// Ordena√ß√£o de favoritos (UI)
document.getElementById("ordemFav").addEventListener("change", mostrarFavoritos);

// Limpar todos favoritos
document.getElementById("limparFav").addEventListener("click", function(){
    const ok = confirm("Remover TODOS os favoritos?");
    if(!ok) return;

    favoritos = [];
    favoritosMeta = {};
    salvarFavoritos();
    atualizarContadorFavoritos();
    mostrarFavoritos();

    // Atualiza os resultados (estrelas)
    document.getElementById("busca").dispatchEvent(new Event("input"));
});
</script>

</body>
</html>
